name: ðŸŽ¬ Render Animation

on:
  push:
      paths:
            - 'config.json'
                  - 'animations/**'
                    workflow_dispatch:   # allows manual trigger from GitHub UI / mobile app

                    jobs:
                      render:
                          runs-on: ubuntu-latest
                              timeout-minutes: 15

                                  steps:
                                        - name: ðŸ“¥ Checkout repo
                                                uses: actions/checkout@v4

                                                      - name: ðŸŸ¢ Setup Node.js
                                                              uses: actions/setup-node@v4
                                                                      with:
                                                                                node-version: '20'
                                                                                          cache: 'npm'

                                                                                                - name: ðŸ“¦ Install dependencies
                                                                                                        run: npm install

                                                                                                              - name: ðŸŽ¥ Install FFmpeg
                                                                                                                      run: sudo apt-get install -y ffmpeg

                                                                                                                            - name: ðŸ–¥ï¸ Install Chromium dependencies
                                                                                                                                    run: |
                                                                                                                                              sudo apt-get install -y \
                                                                                                                                                          libgbm-dev \
                                                                                                                                                                      libnss3 \
                                                                                                                                                                                  libatk-bridge2.0-0 \
                                                                                                                                                                                              libdrm2 \
                                                                                                                                                                                                          libxkbcommon0 \
                                                                                                                                                                                                                      libxcomposite1 \
                                                                                                                                                                                                                                  libxdamage1 \
                                                                                                                                                                                                                                              libxrandr2 \
                                                                                                                                                                                                                                                          libgbm1 \
                                                                                                                                                                                                                                                                      libasound2

                                                                                                                                                                                                                                                                            - name: ðŸŽ¬ Render animation
                                                                                                                                                                                                                                                                                    run: node scripts/render.js

                                                                                                                                                                                                                                                                                          - name: ðŸ“¤ Upload MP4 artifact
                                                                                                                                                                                                                                                                                                  uses: actions/upload-artifact@v4
                                                                                                                                                                                                                                                                                                          with:
                                                                                                                                                                                                                                                                                                                    name: rendered-video
                                                                                                                                                                                                                                                                                                                              path: output/*.mp4
                                                                                                                                                                                                                                                                                                                                        retention-days: 7

                                                                                                                                                                                                                                                                                                                                              - name: âœ… Done
                                                                                                                                                                                                                                                                                                                                                      run: |
                                                                                                                                                                                                                                                                                                                                                                echo "==============================="
                                                                                                                                                                                                                                                                                                                                                                          echo "  Render complete!"
                                                                                                                                                                                                                                                                                                                                                                                    echo "  Download your MP4 above â˜ï¸"
                                                                                                                                                                                                                                                                                                                                                                                              echo "==============================="